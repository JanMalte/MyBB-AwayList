<?xml version="1.0" encoding="UTF-8" ?>
<project name="Contao Facebook" default="sonar">
    <!-- http://jenkins-php.org/ http://sebastian-bergmann.de/archives/911-Debugging-with-Git-and-PHPUnit.html 
        http://www.phpunit.de/manual/2.3/de/phing.html -->
    <property name="project" value="Contao Facebook" />
    <property name="sourcedir" value="." />
    <property name="builddir" value="build" />

    <property name="phpunitreportstyledir" value="/usr/share/php/data/phing/etc/" />

    <fileset dir="${sourcedir}" id="application">
        <include name="**/*.php" />
        <include name="**/*.phtml" />
		<include name="**/*.tpl" />
    </fileset>

    <!-- Clen up last build -->
    <target name="clean" description="Remove the previous existing build directories">
        <echo msg="Clean ..." />
        <delete dir="${builddir}" />
    </target>

    <!-- Prepare build process -->
    <target name="prepare" description="Prepare the build directories"
        depends="clean">
        <echo msg="Prepare ${project} ..." />
        <mkdir dir="${builddir}" />
        <mkdir dir="${builddir}/logs" />
        <mkdir dir="${builddir}/logs/xml" />
        <mkdir dir="${builddir}/logs/selenium" />
        <mkdir dir="${builddir}/logs/phpunit" />
        <mkdir dir="${builddir}/logs/coverage" />
        <mkdir dir="${builddir}/logs/checkstyle" />
        <mkdir dir="${builddir}/logs/pdepend" />
        <mkdir dir="${builddir}/docs" />
        <mkdir dir="${builddir}/code-browser" />
        <mkdir dir="${seleniumDir}" />
        <mkdir dir="${seleniumDir}/screenshots" />
    </target>


    <!-- Define the Sonar task if this hasn't been done in a common script -->
    <taskdef uri="antlib:org.sonar.ant" resource="org/sonar/ant/antlib.xml">
        <classpath path="/usr/share/ant/lib/sonar-ant-task-1.0.jar" />
    </taskdef>

    <!-- Add the target -->
    <target name="sonar">
        <buildnumber />
        <echo>Create Build: ${build.number}</echo>
        <!-- The workDir directory is used by Sonar to store temporary files -->
        <mkdir dir="build/sonar" />
        <sonar:sonar workDir="build/sonar"
            key="VCDS:liste" version="1.0.0-build-${build.number}"
            xmlns:sonar="antlib:org.sonar.ant">
            <!-- source directories (required) -->
            <sources>
                <path location="application/" />
            </sources>

            <!-- list of properties (optional) -->
            <property key="sonar.host.url" value="http://192.168.2.110:9050/" />
            <property key="sonar.projectName" value="Contao Veloticker" />
            <property key="sonar.dynamicAnalysis" value="true" />
            <property key="sonar.language" value="php" />
            <property key="sonar.phpPmd.shouldRun" value="true" />
            <property key="sonar.phpPmd.analyzeOnly" value="false" />
            <property key="sonar.phpCodesniffer.shouldRun" value="true" />
            <property key="sonar.phpCodesniffer.analyzeOnly" value="false" />
            <property key="sonar.phpDepend.shouldRun" value="true" />
            <property key="sonar.phpDepend.analyzeOnly" value="false" />
            <property key="sonar.phpUnit.coverage.shouldRun" value="false" />
            <property key="sonar.phpUnit.analyzeOnly" value="false" />
            <property key="sonar.phpUnit.shouldRun" value="false" />
            <property key="sonar.phpcpd.shouldRun" value="true" />
            <property key="sonar.phpUnit.analyze.test.directory" value="false" />

            <!-- test source directories (optional) -->
            <tests>
                <path location="tests/phpunit/" />
            </tests>
        </sonar:sonar>
    </target>

</project>